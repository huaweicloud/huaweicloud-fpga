Loading an FPGA Image
=====================
[切换到中文版](./load_an_fpga_image_cn.md)


FpgaCmdEntry, FPGA image loading tool, supports FPGA information query, image loading, loading status query ，virtual LED status query and image clearing.

Note: For different types of instances, the number of FPGA devices is different. Here is an example with only one FPGA device.

Loading Procedure
---------------------

**Step 1**: Run the `ls /usr/local/bin/FpgaCmdEntry` command to check that the FPGA image loading tool exists.

    [root@fpga_01]# ls /usr/local/bin/FpgaCmdEntry 
    /usr/local/bin/FpgaCmdEntry
> If the tool does not exist,  please see the chapter of compliling and installing in [fpga_tool README](./../README.md).

**Step 2**: Run the `FpgaCmdEntry DF -D` command to check that there are FPGA devices on the VM. If the value of **DeviceId** is **0xd503**, the device in the current example is a high-perform device. If the value of **DeviceId** is **0xd512**, the device in the current example is a general-purpose device.

	[root@fpga_01]# FpgaCmdEntry DF -D 
	----------------FPGA Information------------------
	     Type			           Fpga Device
	     Slot			           0
	     VendorId			       0x19e5
	     DeviceId			       0xd503
	     DBDF			           0000:00:06.0
	 --------------------------------------------------
	Command execution is complete. 
	
	[root@fpga_02]# FpgaCmdEntry DF -D 
	----------------FPGA Information------------------
	     Type			           Fpga Device
	     Slot			           0
	     VendorId			       0x19e5
	     DeviceId			       0xd512
	     DBDF			           0000:00:06.0
	 -------------------------------------------------- 
	Command execution is complete.


**Step 3**: Run the **FpgaCmdEntry IF -S** *Slot* command to check whether an FPGA image is loaded to the FPGA device in each slot. If the value of **FPGA PR status** is **NOT_PROGRAMMED**, no image is loaded.

**Slot**: Indicates the slot number of the FPGA, which is the slot number of the device that is queried.

	[root@fpga_01]# FpgaCmdEntry IF -S 0 
	-------------Image Information--------------------
	     Type			           Fpga Device
	     Slot			           0
	     VendorId			       0x19e5
	     DeviceId			       0xd503
	     DBDF                       0000:00:06.0
	     AEI ID
		 Shell ID			       01010021
	     FPGA PR status             NOT_PROGRAMMED
	     Load/ClearOpsStatus        INITIALIZED       
	 --------------------------------------------------
	Command execution is complete. 
	
	[root@fpga_02]# FpgaCmdEntry IF -S 0 
	-------------Image Information--------------------
	     Type			           Fpga Device
	     Slot			           0
	     VendorId			       0x19e5
	     DeviceId			       0xd512
	     DBDF                       0000:00:06.0
	     AEI ID
		 Shell ID			       01210002
	     FPGA PR status             NOT_PROGRAMMED
	     Load/ClearOpsStatus        INITIALIZED
	 --------------------------------------------------
	Command execution is complete.


**Step 4**: Run the **FpgaCmdEntry LF -S** *Slot* **-I** *AEI ID* command to load an image to an FPGA device.

**Slot**: Indicates the slot number of the FPGA, which is the slot number of the device that is queried.

**AEI ID**: Indicates the AEI number, which is the FPGA image ID generated by compilation.

	[root@fpga_02]# FpgaCmdEntry LF -S 0 -I ff8080825e9**********74851ee0023
	Command execution is complete.

**Step 5**: Run the **FpgaCmdEntry IF -S** *slot* command to check whether the image is loaded successfully. If the value of **Load/ClearOpsStatus** is **SUCCESS**, the command is executed successfully. If the value of **FPGA PR status** is **PROGRAMMED**, and AEI ID is the same as that in the command, the image is loaded successfully.

	[root@fpga_01]# FpgaCmdEntry IF -S 0 
	 -------------Image Information-------------------- 
	     Type			           Fpga Device
	     Slot			           0
	     VendorId			       0x19e5
	     DeviceId			       0xd503
	     DBDF                       0000:00:06.0
	     AEI ID                     ff8080825e9**********177078f001e
		 Shell ID			       01010021
	     FPGA PR status             PROGRAMMED
	     Load/ClearOpsStatus        SUCCESS
	 -------------------------------------------------- 
	Command execution is complete. 
	
	[root@fpga_02]# FpgaCmdEntry IF -S 0 
	 -------------Image Information-------------------- 
	     Type			           Fpga Device
	     Slot			           0
	     VendorId			       0x19e5
	     DeviceId			       0xd512
	     DBDF                       0000:00:06.0
	     AEI ID                     ff8080825e9**********74851ee0023
		 Shell ID			       01210002
	     FPGA PR status             PROGRAMMED
	     Load/ClearOpsStatus        SUCCESS
	 -------------------------------------------------- 
	Command execution is complete.

**Step 6 (not necessary)**: Run the **FpgaCmdEntry IL -S** *Slot* command to check the LED status of the corresponding slot. The LED status value is set by the user when loading PR. The query result can be used to determine whether the function of the loaded image is normal. When the result is consistent with the settings, the image function is normal.

**Note**: General-purpose devices do not support LED status query.

```
[root@fpga_01]# FpgaCmdEntry IL -S 0 
LED Status(H): 0x0 
LED Status(H): 0000|0000|0000|0000|0000|0000|0000|0000 
Command execution is complete. 

[root@fpga_02]# FpgaCmdEntry IL -S 0 
General purpose architecture device doesn't support user LED.
Command execution is complete.
```

> For details about how to set the VLED data register, contact Huawei technical support.

Clearing Procedure
---------------------

**Step 1**: Run the **FpgaCmdEntry CF -S** *Slot* command to clear the FPGA image.

**Slot**: Indicates the slot number of the FPGA, which is the slot number of the device that is queried.

```
[root@fpga_02]# FpgaCmdEntry CF -S 0
Command execution is complete.
```

**Step 2**: Run the **FpgaCmdEntry IL -S** *Slot* command to check whether the image is cleared. If the value of **Load/ClearOpsStatus** is **SUCCESS**, the command is executed successfully. If the value of **FPGA PR status** is **NOT_PROGRAMMED**, and AEI ID is none, the image is cleared successfully.

	[root@fpga_01]# FpgaCmdEntry IF -S 0 
	 -------------Image Information-------------------- 
	     Type			           Fpga Device
	     Slot			           0
	     VendorId			       0x19e5
	     DeviceId			       0xd503
	     DBDF                       0000:00:06.0
	     AEI ID                    
		 Shell ID			       01010021
	     FPGA PR status             NOT_PROGRAMMED
	     Load/ClearOpsStatus        SUCCESS
	 -------------------------------------------------- 
	Command execution is complete. 
	
	[root@fpga_02]# FpgaCmdEntry IF -S 0 
	 -------------Image Information-------------------- 
	     Type			           Fpga Device
	     Slot			           0
	     VendorId			       0x19e5
	     DeviceId			       0xd512
	     DBDF                       0000:00:06.0
	     AEI ID                    
		 Shell ID			       01210002
	     FPGA PR status             NOT_PROGRAMMED
	     Load/ClearOpsStatus        SUCCESS
	 -------------------------------------------------- 
	Command execution is complete.

\----End
